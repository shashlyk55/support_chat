<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="styles/style.css">
</head>
<body>
    <div class="show-popup-btn" id="show-popup-btn">
        <img class="icon" id="icon" src="source/svg/close_btn.svg" alt="">
        <input type="checkbox" onchange="changeIcon()" id="show-popup-checkbox">
    </div>

    <div class="sidepop-up dark">
        <div class="head">
            <div class="container">
                <div class="profile">
                    <div class="profile-avatar">
                        <img src="source/avatar.png" alt="profile_avatar">
                    </div>
                    <div class="profile-info">
                        <p class="username">Менеджер Валентин</p>
                        <span class="user-status">
                            <svg width="6" height="6" viewBox="0 0 6 6" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="3" cy="3" r="3" fill="#11CABE"/>
                            </svg>    
                            <p>Онлайн</p>
                        </span>
                    </div>
                </div>
                <div class="close-btn" id="close-btn" onclick="closeWindow()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18.8894 17.2728L11.6163 9.99971L18.8894 2.72661C19.1037 2.51229 19.2242 2.2216 19.2242 1.91849C19.2242 1.61539 19.1037 1.3247 18.8894 1.11037C18.6751 0.896042 18.3844 0.775635 18.0813 0.775635C17.7782 0.775635 17.4875 0.896042 17.2732 1.11037L10.0001 8.38347L2.72698 1.11037C2.51265 0.896042 2.22196 0.775635 1.91886 0.775635C1.61575 0.775635 1.32506 0.896042 1.11074 1.11037C0.896409 1.3247 0.776002 1.61539 0.776002 1.91849C0.776002 2.2216 0.896409 2.51229 1.11074 2.72661L8.38383 9.99971L1.11074 17.2728C0.896409 17.4871 0.776001 17.7778 0.776001 18.0809C0.776001 18.384 0.896409 18.6747 1.11074 18.8891C1.32506 19.1034 1.61575 19.2238 1.91886 19.2238C2.22196 19.2238 2.51265 19.1034 2.72698 18.8891L10.0001 11.616L17.2732 18.8891C17.4875 19.1034 17.7782 19.2238 18.0813 19.2238C18.3844 19.2238 18.6751 19.1034 18.8894 18.8891C19.1037 18.6747 19.2242 18.384 19.2242 18.0809C19.2242 17.7778 19.1037 17.4871 18.8894 17.2728Z" fill="white"/>
                    </svg>
                </div>
            </div>
        </div>
        <div class="chat">
            <!--<div class="download-doc-container">
                <div class="put-file-icon">
                    <svg width="40" height="28" viewBox="0 0 40 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M20 0.5C14.85 0.5 10.8 4.4125 10.2338 9.40625C9.1448 9.5824 8.12363 10.0494 7.2781 10.7578C6.43256 11.4663 5.79405 12.3899 5.43 13.4313C2.355 14.3175 0 17.06 0 20.5C0 24.655 3.345 28 7.5 28H32.5C36.655 28 40 24.655 40 20.5C40 18.3 38.9313 16.33 37.3825 14.9525C37.0925 10.56 33.5887 7.055 29.18 6.8275C27.675 3.16625 24.2225 0.5 20 0.5ZM20 3C23.4525 3 26.2125 5.2125 27.1875 8.35L27.4625 9.25H28.75C32.1937 9.25 35 12.0562 35 15.5V16.125L35.5075 16.5163C36.12 16.9857 36.6177 17.5883 36.9629 18.2785C37.3081 18.9687 37.4918 19.7283 37.5 20.5C37.5 23.345 35.345 25.5 32.5 25.5H7.5C4.655 25.5 2.5 23.345 2.5 20.5C2.5 17.975 4.3125 16.015 6.6 15.6175L7.42125 15.4613L7.5775 14.6388C7.9525 12.955 9.445 11.75 11.25 11.75H12.5V10.5C12.5 6.2875 15.7875 3 20 3ZM20.6903 10.6492C20.3038 10.2815 19.6967 10.2819 19.3107 10.6502L19.1 10.8512L14.8071 15.1441C14.4166 15.5347 14.4166 16.1678 14.8071 16.5584L15.1923 16.9435C15.583 17.3343 16.2167 17.334 16.6071 16.9429L18.75 14.7963V22C18.75 22.5523 19.1977 23 19.75 23H20.25C20.8023 23 21.25 22.5523 21.25 22V14.7963L23.3929 16.941C23.7834 17.3318 24.4168 17.332 24.8074 16.9413L25.1929 16.5559C25.5834 16.1653 25.5834 15.5322 25.1929 15.1416L20.9 10.8488L20.6903 10.6492Z" fill="white"/>
                    </svg>
                    <p>Перенесите выбранный файл сюда</p>   
                </div>
            </div>-->
            <div class="date">Сегодня</div>
            <div class="messages" id="chat-container">
                <!-- If chat is empty -->
                <!--<div class="empty-chat">
                    Отправьте нам сообщение.<br>Мы ответим Вам в ближайшее время!
                </div>-->

                <!-- If chat has messages -->
                <div class="message-container">
                    <div class="message-group">
                        <div class="message">
                            Hello, I’m experiencing an issue with my account. Could you please help me resolve it?
                        </div>
                    </div>
                    <div class="sender">
                        <span class="send-time">
                            13:48
                        </span>
                        <div class="sender-avatar">
                            <img src="source/svg/user_avatar.svg" alt="user">
                        </div>
                    </div>
                </div>
                <div class="message-container" data-support-team-msg>
                    <div class="message-group">
                        <div class="message">
                            Of course! I’d be happy to assist you. Could you please describe the problem you’re having?               
                        </div>
                    </div>
                    <div class="sender">
                        <span class="send-time">
                            13:47
                        </span>
                        <div class="sender-avatar">
                            <img src="source/avatar.png" alt="user">
                        </div>
                    </div>
                </div>
                <div class="message-container">
                    <div class="message-group">
                        <div class="message">
                            Sure.
                        </div>
                        <div class="message">
                            Every time I try, I receive an “incorrect password” message, even though I’m sure the password is correct.                        
                        </div>
                    </div>
                    <div class="sender">
                        <span class="send-time">
                            13:47
                        </span>
                        <div class="sender-avatar">
                            <img src="source/svg/user_avatar.svg" alt="user">
                        </div>
                    </div>
                </div>
                <div class="message-container" data-support-team-msg>
                    <div class="message-group">
                        <div class="message">
                            Thank you for the information. Have you tried resetting your password yet?  
                            <!-- Pinned voice message -->  
                            <!--<div class="voice-msg-container">
                                <div class="play-voice-msg-btn">
                                    <img src="source/svg/play_voice_msg.svg" alt="play_voice">
                                </div>
                                <div class="waves">
                                    <div style="height: 10px;"></div>
                                    <div style="height: 18px;"></div>
                                    <div style="height: 6px;"></div>
                                    <div style="height: 11px;"></div>
                                    <div style="height: 8px;"></div>
                                    <div style="height: 18px;"></div>
                                    <div style="height: 15px;"></div>
                                    <div style="height: 10px;"></div>
                                    <div style="height: 6px;"></div>
                                    <div style="height: 10px;"></div>
                                    <div style="height: 11px;"></div>
                                    <div style="height: 12px;"></div>
                                    <div style="height: 14px;"></div>
                                    <div style="height: 18px;"></div>
                                    <div style="height: 10px;"></div>
                                    <div style="height: 14px;"></div>
                                    <div style="height: 8px;"></div>
                                    <div style="height: 14px;"></div>
                                </div>
                                <div class="timer">
                                    <span>00:24</span>
                                </div>
                                <div class="delete-msg-btn">
                                    <img src="source/svg/delete_msg.svg" alt="delete_voice">
                                </div>
                            </div>-->              
                            <!-- Pinned document -->
                            <!--<div class="doc-container">
                                <div class="open-doc-btn">
                                    <img src="source/svg/document.svg" alt="doc">
                                </div>
                                <div class="doc-info">
                                    <span class="doc-name">Screenshot 2024-10-21</span>
                                    <span class="doc-size">32kB</span>
                                </div>
                                <div class="delete-msg-btn">
                                    <img src="source/svg/delete_msg.svg" alt="delete_voice">
                                </div>
                            </div>-->
                        </div>
                    </div>
                    <div class="sender">
                        <span class="send-time">
                            13:47
                        </span>
                        <div class="sender-avatar">
                            <img src="source/avatar.png" alt="user">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="message-input">
            <div class="msg-input-fields">
                <!-- Recording voice message -->
                <!--<div class="voice-msg-container">
                    <div class="waves">
                        <div style="height: 10px;"></div>
                        <div style="height: 18px;"></div>
                        <div style="height: 6px;"></div>
                        <div style="height: 11px;"></div>
                        <div style="height: 8px;"></div>
                        <div style="height: 18px;"></div>
                        <div style="height: 15px;"></div>
                        <div style="height: 10px;"></div>
                        <div style="height: 6px;"></div>
                        <div style="height: 10px;"></div>
                        <div style="height: 11px;"></div>
                        <div style="height: 12px;"></div>
                        <div style="height: 14px;"></div>
                        <div style="height: 18px;"></div>
                        <div style="height: 10px;"></div>
                        <div style="height: 14px;"></div>
                        <div style="height: 8px;"></div>
                        <div style="height: 14px;"></div>
                    </div>
                    <div class="timer">
                        <span>00:24</span>
                    </div>
                </div>-->
                
                <!-- Recorded voice message -->
                <!--<div class="voice-msg-container">
                    <div class="play-voice-msg-btn">
                        <img src="source/svg/play_voice_msg.svg" alt="play_voice">
                    </div>
                    <div class="waves">
                        <div style="height: 10px;"></div>
                        <div style="height: 18px;"></div>
                        <div style="height: 6px;"></div>
                        <div style="height: 11px;"></div>
                        <div style="height: 8px;"></div>
                        <div style="height: 18px;"></div>
                        <div style="height: 15px;"></div>
                        <div style="height: 10px;"></div>
                        <div style="height: 6px;"></div>
                        <div style="height: 10px;"></div>
                        <div style="height: 11px;"></div>
                        <div style="height: 12px;"></div>
                        <div style="height: 14px;"></div>
                        <div style="height: 18px;"></div>
                        <div style="height: 10px;"></div>
                        <div style="height: 14px;"></div>
                        <div style="height: 8px;"></div>
                        <div style="height: 14px;"></div>
                    </div>
                    <div class="timer">
                        <span>00:24</span>
                    </div>
                    <div class="delete-msg-btn">
                        <img src="source/svg/delete_msg.svg" alt="delete_voice">
                    </div>
                </div>-->

                <!-- Play voice message -->
                <!--<div class="voice-msg-container">
                    <div class="play-voice-msg-btn">
                        <img src="source/svg/pause_voice_msg.svg" alt="play_voice">
                    </div>
                    <div class="waves">
                        <div style="height: 10px;background-color: #006fff;"></div>
                        <div style="height: 18px;background-color: #006fff;"></div>
                        <div style="height: 6px;background-color: #006fff;"></div>
                        <div style="height: 11px;background-color: #006fff;"></div>
                        <div style="height: 8px;background-color: #006fff;"></div>
                        <div style="height: 18px;background-color: #006fff;"></div>
                        <div style="height: 15px;background-color: #006fff;"></div>
                        <div style="height: 10px;"></div>
                        <div style="height: 6px;"></div>
                        <div style="height: 10px;"></div>
                        <div style="height: 11px;"></div>
                        <div style="height: 12px;"></div>
                        <div style="height: 14px;"></div>
                        <div style="height: 18px;"></div>
                        <div style="height: 10px;"></div>
                        <div style="height: 14px;"></div>
                        <div style="height: 8px;"></div>
                        <div style="height: 14px;"></div>
                    </div>
                    <div class="timer">
                        <span>00:10/00:24</span>
                    </div>
                    <div class="delete-msg-btn">
                        <img src="source/svg/delete_msg.svg" alt="delete_voice">
                    </div>
                </div>-->

                <!-- Send document -->
                <!--<div class="doc-container">
                    <div class="open-doc-btn">
                        <img src="source/svg/document.svg" alt="doc">
                    </div>
                    <div class="doc-info">
                        <span class="doc-name">Screenshot 2024-10-21</span>
                        <span class="doc-size">32kB</span>
                    </div>
                    <div class="delete-msg-btn">
                        <img src="source/svg/delete_msg.svg" alt="delete_voice">
                    </div>
                </div>-->
            
                <!-- Text message -->
                <div class="input-field">
                    <textarea class="input-message" id="input-message" placeholder="Введите свое сообщение..."></textarea>
                </div>
            </div>
            <div class="buttons">
                <!-- Recording voice message -->
                <!--<div>
                    <img src="source/svg/record_voice_msg.svg" alt="record_voice_msg">
                </div>-->
                <!-- Write text message -->
                <div>
                    <img src="source/svg/voice_msg.svg" alt="voice_msg">
                </div>
                <div>
                    <img src="source/svg/pin_msg_btn.svg" alt="pin_msg">
                </div>
                <div onclick="sendMessage()">
                    <img src="source/svg/send_msg_btn.svg" alt="send_btn">
                </div>
            </div>
        </div>
    </div>

</body>
<script>
    
    const adjustMessageWidth = () => {
            const messages = document.querySelector('.messages')
            const messageContainers = messages.querySelectorAll('.message-container')
            
            const screenWidth = window.innerWidth;

            document.querySelectorAll('.message').forEach((message) => {
                if(screenWidth < 476 && screenWidth >= 375){
                    message.style.maxWidth = (screenWidth - 112) + 'px'
                } else if(screenWidth < 375) {
                    message.style.maxWidth = (screenWidth - 72) + 'px'
                }
            })
        };

    adjustMessageWidth();

    window.addEventListener('resize', adjustMessageWidth);

    const inputMessage = document.querySelector('.input-message')

    document.addEventListener('DOMContentLoaded', () => {
        inputMessage.focus()
    });

    function closeWindow(){
        const showPopupCheckbox = document.getElementById('show-popup-checkbox')
        showPopupCheckbox.checked = true
        changeIcon()
    }

    function changeIcon(){
        const checkbox = document.getElementById('show-popup-checkbox')
        const icon = document.getElementById('icon')
            
        if(checkbox.checked) {
            icon.src = 'source/svg/show_popup_btn.svg'
        } else {
            icon.src = 'source/svg/close_btn.svg'
        }
    }
        
    function adjustHeight() {
        inputMessage.style.height = 'auto'; 
        let scrollHeight = inputMessage.scrollHeight;
        
        if (scrollHeight > (window.innerWidth > 375 ? 144 : 108) ) {
            inputMessage.style.height = window.innerWidth > 375 ? '144px' : '108px'; 
            inputMessage.style.overflowY = 'auto'; 
        } else {
            inputMessage.style.height = scrollHeight + 'px'; 
            inputMessage.style.overflowY = 'hidden'; 
        }
    }
    inputMessage.addEventListener('input', adjustHeight)

    function createElement(opts = {}) {
        let ele = document.createElement('div');
        if('class' in opts) {
            if(!Array.isArray(opts.class)) {
                opts.class = [ opts.class ];
            }
            ele.classList.add(...opts.class);
        }
        return ele;
    }

    function sendMessage() {
        
        console.log('send message');
        
        const chatContainer = document.getElementById('chat-container')
        const messageText = inputMessage.value.trim()

        if(messageText === '') return

        const message = createElement({ class: 'message' })
        message.textContent = messageText

        const currentDate = new Date()
        const hours = String(currentDate.getHours()).padStart(2, '0')
        const minutes = String(currentDate.getMinutes()).padStart(2, '0')
        const sendingTime = `${hours}:${minutes}`
        
        const messageContainers = document.getElementsByClassName('message-container')
        const lastMessageContainer = messageContainers[messageContainers.length - 1]

        if(lastMessageContainer.hasAttribute('data-support-team-msg')) {
            const messageContainer = createElement({ class: 'message-container' })
            const messageGroup = createElement({ class: 'message-group' })
            messageGroup.appendChild(message)

            const senderContainer = createElement({ class: 'sender' })
            const sendTime = createElement({ class: 'send-time' })
            const senderAvatar = createElement({ class: 'sender-avatar'})
            senderAvatar.innerHTML+= '<img src="source/svg/user_avatar.svg" alt="user">'
            
            sendTime.textContent = sendingTime

            senderContainer.appendChild(sendTime)
            senderContainer.appendChild(senderAvatar)

            messageContainer.appendChild(messageGroup)
            messageContainer.appendChild(senderContainer)

            chatContainer.appendChild(messageContainer)
            
        } else {
            const messageGroup = lastMessageContainer.querySelector('.message-group')
            messageGroup.appendChild(message)

            lastMessageContainer.querySelector('.send-time').textContent = sendingTime
        }
        
        adjustMessageWidth();
        
        chatContainer.scrollTop = chatContainer.scrollHeight

        inputMessage.value = ''
        inputMessage.style.height = 'auto'
        inputMessage.focus()

    }

    inputMessage.addEventListener('keydown', (event) => {
        if(event.key === 'Enter') {
            event.preventDefault()
            sendMessage()
        }
    })    

</script>
</html>